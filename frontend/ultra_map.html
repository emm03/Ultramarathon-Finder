<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Ultra Map - Ultramarathon Connect</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="alanai_chatbot/chat-widget.css" />
    <link rel="icon" href="ultra_favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- üîê Load global login/session logic -->
    <script src="auth_utils.js" defer></script>
</head>

<body class="forum-page">
    <header class="sticky-header dual-row-header">
        <div class="header-top-row">
            <div class="mobile-header-container">
                <a href="index.html" class="header-left" style="text-decoration: none; color: inherit;">
                    <img src="ultra.png" alt="Ultramarathon Connect Logo" class="logo" />
                    <span class="site-title">UltramarathonConnect</span>
                </a>
                <button class="menu-toggle">‚ò∞</button>
            </div>
            <div id="account-tab" class="auth-tab mobile-account-tab"></div>
        </div>

        <div class="header-bottom-row">
            <nav class="header-right">
                <ul class="menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="race_directory.html">Race Directory</a></li>
                    <li><a href="forum.html">Runner Community</a></li>
                    <li><a href="articles.html">Articles</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main style="padding-top: 140px;">
        <!-- üß≠ Hero Header Section -->
        <section class="ultra-map-hero">
            <div class="hero-content">
                <h1>üìç My Ultra Map</h1>
                <p>Every run over 26.2 miles ‚Äî visualized across the globe.</p>
            </div>
            <div class="ultra-stats-card">
                <p><strong>Total Ultra Runs:</strong> <span id="ultra-count">0</span></p>
                <p><strong>Total Distance:</strong> <span id="ultra-distance">0 mi</span></p>
                <p><strong>Longest Run:</strong> <span id="longest-run">0 mi</span></p>
                <p><strong>Unique Locations:</strong> <span id="unique-locations">0</span></p>
            </div>
            <!-- üîÆ Alan AI Suggestion Button -->
            <button onclick="askAlanBasedOnMap()" class="orange-btn">Ask Alan for Race Suggestions</button>
        </section>

        <!-- üó∫Ô∏è Ultra Map Display (now also shows visited states) -->
        <div id="ultra-map" style="height: 500px;"></div>

        <!-- üåé Visited States Count -->
        <section id="visited-regions" style="margin: 40px 20px;">
            <h2 class="chart-title">üåé States Where You've Completed Ultras</h2>
            <p><strong>States Completed:</strong> <span id="visited-states-count">0</span></p>
        </section>

        <!-- üï∞Ô∏è Ultra Completion Timeline -->
        <section id="ultra-timeline-section" style="margin: 40px 20px;">
            <h2 class="chart-title">üìà Ultra Completion Timeline</h2>
            <canvas id="ultraTimelineChart" width="100%" height="60"></canvas>
        </section>

        <!-- üñºÔ∏è Strava Photo Timeline -->
        <section id="strava-photo-timeline" style="margin: 40px 20px;">
            <h2 class="chart-title">üñºÔ∏è My Ultra Photo Timeline</h2>
            <div id="photo-scroll-container" class="photo-scroll"></div>
        </section>
    </main>

    <!-- Alan Chat Widget -->
    <div id="alan-bubble">üí¨</div>
    <div id="alan-window">
        <div id="alan-messages"></div>
        <form id="alan-form">
            <input id="alan-input" type="text" placeholder="Ask Alan about races..." />
            <button type="submit">Send</button>
        </form>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-links">
            <a href="contact.html">Contact Us</a> |
            <a href="privacy.html">Privacy Policy</a> |
            <a href="termsofservice.html">Terms of Service</a> |
            <a href="faq.html">FAQ</a> |
        </div>
        <p class="footer-copy">&copy; 2025 Ultramarathon Connect. All rights reserved.</p>
    </footer>

    <!-- üîç Lightbox Modal for Enlarged Ultra Photos -->
    <div id="photo-lightbox"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); align-items:center; justify-content:center; z-index:1000;">
        <img id="lightbox-image"
            style="max-width:90%; max-height:90%; border-radius:10px; box-shadow:0 0 20px rgba(255,255,255,0.3);" />
    </div>

    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="alanai_chatbot/alan.js"></script>
    <script src="forum/inject_account_dropdown.js"></script>
    <script src="ultra_map_script.js"></script>

</body>

</html>